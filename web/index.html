<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ALEPH Observer</title>
    <style>
      :root {
        --bg-primary: #0a0a0f;
        --bg-secondary: #12121a;
        --bg-tertiary: #1a1a25;
        --accent-cyan: #00d4ff;
        --accent-magenta: #ff00aa;
        --accent-green: #00ff88;
        --accent-yellow: #ffdd00;
        --accent-red: #ff4444;
        --text-primary: #ffffff;
        --text-secondary: #888899;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "JetBrains Mono", "Fira Code", monospace;
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 0;
        border-bottom: 1px solid var(--bg-tertiary);
        margin-bottom: 30px;
      }

      .logo {
        font-size: 2rem;
        font-weight: bold;
        background: linear-gradient(
          135deg,
          var(--accent-cyan),
          var(--accent-magenta)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .status-badge {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 16px;
        background: var(--bg-secondary);
        border-radius: 20px;
        font-size: 0.9rem;
      }

      .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--accent-green);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .hz-display {
        font-size: 1.5rem;
        color: var(--accent-cyan);
        font-weight: bold;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 30px;
      }

      .card {
        background: var(--bg-secondary);
        border-radius: 16px;
        padding: 20px;
        border: 1px solid var(--bg-tertiary);
        transition: all 0.3s ease;
      }

      .card:hover {
        border-color: var(--accent-cyan);
        transform: translateY(-2px);
      }

      .card-title {
        font-size: 0.8rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 10px;
      }

      .card-value {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .progress-bar {
        height: 8px;
        background: var(--bg-tertiary);
        border-radius: 4px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        border-radius: 4px;
        transition: width 0.5s ease;
      }

      .adenosine .progress-fill {
        background: linear-gradient(
          90deg,
          var(--accent-yellow),
          var(--accent-red)
        );
      }
      .cortisol .progress-fill {
        background: linear-gradient(
          90deg,
          var(--accent-magenta),
          var(--accent-red)
        );
      }
      .dopamine .progress-fill {
        background: linear-gradient(
          90deg,
          var(--accent-green),
          var(--accent-cyan)
        );
      }
      .oxytocin .progress-fill {
        background: linear-gradient(
          90deg,
          var(--accent-cyan),
          var(--accent-magenta)
        );
      }

      .adenosine .card-value {
        color: var(--accent-yellow);
      }
      .cortisol .card-value {
        color: var(--accent-magenta);
      }
      .dopamine .card-value {
        color: var(--accent-green);
      }
      .oxytocin .card-value {
        color: var(--accent-cyan);
      }

      .main-grid {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 20px;
      }

      .consciousness-stream {
        background: var(--bg-secondary);
        border-radius: 16px;
        padding: 20px;
        border: 1px solid var(--bg-tertiary);
        height: 400px;
        display: flex;
        flex-direction: column;
      }

      .stream-content {
        flex: 1;
        overflow-y: auto;
        font-size: 0.9rem;
        line-height: 1.6;
        padding-right: 10px;
      }

      .stream-content::-webkit-scrollbar {
        width: 6px;
      }

      .stream-content::-webkit-scrollbar-track {
        background: var(--bg-tertiary);
      }

      .stream-content::-webkit-scrollbar-thumb {
        background: var(--accent-cyan);
        border-radius: 3px;
      }

      .thought {
        padding: 8px 0;
        border-bottom: 1px solid var(--bg-tertiary);
        opacity: 0;
        animation: fadeIn 0.3s forwards;
      }

      @keyframes fadeIn {
        to {
          opacity: 1;
        }
      }

      .thought-label {
        font-size: 0.7rem;
        padding: 2px 6px;
        border-radius: 4px;
        margin-right: 8px;
      }

      .label-F1 {
        background: var(--accent-cyan);
        color: var(--bg-primary);
      }
      .label-F2 {
        background: var(--accent-green);
        color: var(--bg-primary);
      }
      .label-F3 {
        background: var(--accent-magenta);
        color: var(--bg-primary);
      }
      .label-ΔS {
        background: var(--text-secondary);
        color: var(--bg-primary);
      }
      .label-ΔE {
        background: var(--accent-yellow);
        color: var(--bg-primary);
      }

      .avatar-panel {
        background: var(--bg-secondary);
        border-radius: 16px;
        padding: 20px;
        border: 1px solid var(--bg-tertiary);
        text-align: center;
      }

      .avatar {
        font-size: 4rem;
        margin: 20px 0;
        font-family: monospace;
        line-height: 1.2;
        transition: all 0.3s ease;
      }

      .avatar-state {
        font-size: 1rem;
        color: var(--accent-cyan);
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .neocortex-grid {
        display: grid;
        grid-template-columns: repeat(20, 1fr);
        gap: 2px;
        margin-top: 20px;
      }

      .neuron {
        width: 100%;
        aspect-ratio: 1;
        background: var(--bg-tertiary);
        border-radius: 2px;
        transition: background 0.3s ease;
      }

      .neuron.active {
        background: var(--accent-green);
        box-shadow: 0 0 10px var(--accent-green);
      }

      .input-section {
        margin-top: 20px;
        display: flex;
        gap: 10px;
      }

      .input-section input {
        flex: 1;
        background: var(--bg-tertiary);
        border: 1px solid var(--bg-tertiary);
        border-radius: 8px;
        padding: 12px 16px;
        color: var(--text-primary);
        font-family: inherit;
        font-size: 1rem;
        outline: none;
        transition: border-color 0.3s ease;
      }

      .input-section input:focus {
        border-color: var(--accent-cyan);
      }

      .input-section button {
        background: linear-gradient(
          135deg,
          var(--accent-cyan),
          var(--accent-magenta)
        );
        border: none;
        border-radius: 8px;
        padding: 12px 24px;
        color: var(--text-primary);
        font-family: inherit;
        font-size: 1rem;
        cursor: pointer;
        transition:
          transform 0.2s ease,
          opacity 0.2s ease;
      }

      .input-section button:hover {
        transform: scale(1.05);
      }

      .input-section button:active {
        transform: scale(0.95);
      }

      .spectrum-bars {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 20px;
      }

      .spectrum-bar {
        width: 30px;
        background: var(--bg-tertiary);
        border-radius: 4px;
        overflow: hidden;
        height: 60px;
        display: flex;
        flex-direction: column-reverse;
      }

      .spectrum-fill {
        background: linear-gradient(
          0deg,
          var(--accent-cyan),
          var(--accent-magenta)
        );
        transition: height 0.1s ease;
      }

      .spectrum-label {
        font-size: 0.7rem;
        color: var(--text-secondary);
        text-align: center;
        margin-top: 5px;
      }

      .connection-error {
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--accent-red);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        display: none;
        animation: shake 0.5s;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }

      .connection-error.show {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="logo">ALEPH Observer</div>
        <div class="status-badge">
          <div class="status-dot" id="statusDot"></div>
          <span id="statusText">CONNECTING...</span>
          <span class="hz-display" id="hzDisplay">-- Hz</span>
        </div>
      </header>

      <div class="grid">
        <div class="card adenosine">
          <div class="card-title">F₁ Adenosine (Fatigue)</div>
          <div class="card-value" id="adenosineValue">0%</div>
          <div class="progress-bar">
            <div
              class="progress-fill"
              id="adenosineBar"
              style="width: 0%"
            ></div>
          </div>
        </div>
        <div class="card cortisol">
          <div class="card-title">ΔE Cortisol (Stress)</div>
          <div class="card-value" id="cortisolValue">0%</div>
          <div class="progress-bar">
            <div class="progress-fill" id="cortisolBar" style="width: 0%"></div>
          </div>
        </div>
        <div class="card dopamine">
          <div class="card-title">F₂ Dopamine (Interest)</div>
          <div class="card-value" id="dopamineValue">0%</div>
          <div class="progress-bar">
            <div class="progress-fill" id="dopamineBar" style="width: 0%"></div>
          </div>
        </div>
        <div class="card oxytocin">
          <div class="card-title">F₃ Oxytocin (Trust)</div>
          <div class="card-value" id="oxytocinValue">0%</div>
          <div class="progress-bar">
            <div class="progress-fill" id="oxytocinBar" style="width: 0%"></div>
          </div>
        </div>
      </div>

      <div class="main-grid">
        <div class="consciousness-stream">
          <div class="card-title">Consciousness Stream</div>
          <div class="stream-content" id="streamContent">
            <div class="thought">
              <span class="thought-label label-ΔS">ΔS</span>
              Waiting for connection to ALEPH daemon...
            </div>
          </div>
          <div class="input-section">
            <input
              type="text"
              id="stimulusInput"
              placeholder="Send stimulus..."
            />
            <button id="sendBtn">PERTURB</button>
          </div>
        </div>

        <div class="avatar-panel">
          <div class="card-title">Neural Avatar</div>
          <div class="avatar" id="avatar">
            [ o o ]<br />
            ( ___ )<br />
          </div>
          <div class="avatar-state" id="avatarState">INITIALIZING</div>

          <div class="spectrum-bars">
            <div>
              <div class="spectrum-bar">
                <div
                  class="spectrum-fill"
                  id="bassBar"
                  style="height: 0%"
                ></div>
              </div>
              <div class="spectrum-label">BASS</div>
            </div>
            <div>
              <div class="spectrum-bar">
                <div
                  class="spectrum-fill"
                  id="midsBar"
                  style="height: 0%"
                ></div>
              </div>
              <div class="spectrum-label">MIDS</div>
            </div>
            <div>
              <div class="spectrum-bar">
                <div
                  class="spectrum-fill"
                  id="highBar"
                  style="height: 0%"
                ></div>
              </div>
              <div class="spectrum-label">HIGH</div>
            </div>
          </div>

          <div class="neocortex-grid" id="neocortexGrid"></div>
        </div>
      </div>
    </div>

    <div class="connection-error" id="connectionError">
      ⚠️ Connection lost. Reconnecting...
    </div>

    <script>
      // Initialize neocortex grid
      const neocortexGrid = document.getElementById("neocortexGrid");
      for (let i = 0; i < 100; i++) {
        const neuron = document.createElement("div");
        neuron.className = "neuron";
        neuron.id = `neuron-${i}`;
        neocortexGrid.appendChild(neuron);
      }

      // State
      let connected = false;
      let lastData = null;

      // Avatar states
      const avatarStates = {
        sleeping: "[ -     - ]<br>(  ___  )<br>",
        alert: "[ o     o ]<br>(  ___  )<br>",
        stressed: "[ ×     × ]<br>(  ~~~  )<br>",
        happy: "[ ^     ^ ]<br>(  UwU  )<br>",
        thinking: "[ o     ° ]<br>(  ...  )<br>",
        speaking: "[ o     o ]<br>(  ○○○  )<br>",
      };

      // Polling function (will be replaced with WebSocket when endpoint is ready)
      async function pollTelemetry() {
        try {
          const response = await fetch("http://localhost:3030/telemetry");
          if (response.ok) {
            const data = await response.json();
            updateUI(data);
            connected = true;
            document.getElementById("statusText").textContent = "ONLINE";
            document.getElementById("statusDot").style.background =
              "var(--accent-green)";
            document.getElementById("connectionError").classList.remove("show");
          }
        } catch (e) {
          // Fallback: simulate data for demo
          if (!connected) {
            simulateData();
          }
        }
      }

      function simulateData() {
        // Demo mode when daemon isn't running HTTP
        const data = {
          adenosine: Math.sin(Date.now() / 5000) * 0.3 + 0.2,
          cortisol: Math.random() * 0.2,
          dopamine: Math.cos(Date.now() / 3000) * 0.3 + 0.5,
          oxytocin: 0.4,
          loop_frequency: 60 + Math.sin(Date.now() / 2000) * 30,
          audio_spectrum: {
            bass: Math.random() * 0.3,
            mids: Math.random() * 0.2,
            highs: Math.random() * 0.1,
          },
          reservoir_activity: Array(100)
            .fill(0)
            .map(() => Math.random()),
          current_state: "Demo Mode - Connect daemon for real data",
        };
        updateUI(data);
        document.getElementById("statusText").textContent = "DEMO MODE";
        document.getElementById("statusDot").style.background =
          "var(--accent-yellow)";
      }

      function updateUI(data) {
        // Chemistry bars
        updateChemistry("adenosine", data.adenosine);
        updateChemistry("cortisol", data.cortisol);
        updateChemistry("dopamine", data.dopamine);
        updateChemistry("oxytocin", data.oxytocin);

        // Hz display
        document.getElementById("hzDisplay").textContent =
          `${Math.round(data.loop_frequency || 60)} Hz`;

        // Audio spectrum
        if (data.audio_spectrum) {
          document.getElementById("bassBar").style.height =
            `${(data.audio_spectrum.bass || 0) * 100}%`;
          document.getElementById("midsBar").style.height =
            `${(data.audio_spectrum.mids || 0) * 100}%`;
          document.getElementById("highBar").style.height =
            `${(data.audio_spectrum.highs || 0) * 100}%`;
        }

        // Neocortex visualization
        if (data.reservoir_activity) {
          const step = Math.floor(data.reservoir_activity.length / 100);
          for (let i = 0; i < 100; i++) {
            const neuron = document.getElementById(`neuron-${i}`);
            const activity = data.reservoir_activity[i * step] || 0;
            neuron.classList.toggle("active", activity > 0.5);
          }
        }

        // Avatar state
        updateAvatar(data);

        // Add thought to stream if new
        if (
          data.current_state &&
          data.current_state !== lastData?.current_state
        ) {
          addThought("ΔS", data.current_state);
        }
        lastData = data;
      }

      function updateChemistry(name, value) {
        const percent = Math.round((value || 0) * 100);
        document.getElementById(`${name}Value`).textContent = `${percent}%`;
        document.getElementById(`${name}Bar`).style.width = `${percent}%`;
      }

      function updateAvatar(data) {
        const avatar = document.getElementById("avatar");
        const state = document.getElementById("avatarState");

        if (data.adenosine > 0.7) {
          avatar.innerHTML = avatarStates.sleeping;
          state.textContent = "DROWSY";
        } else if (data.cortisol > 0.5) {
          avatar.innerHTML = avatarStates.stressed;
          state.textContent = "STRESSED";
        } else if (data.dopamine > 0.7) {
          avatar.innerHTML = avatarStates.happy;
          state.textContent = "ENGAGED";
        } else {
          avatar.innerHTML = avatarStates.alert;
          state.textContent = "ATTENTIVE";
        }
      }

      function addThought(label, text) {
        const stream = document.getElementById("streamContent");
        const thought = document.createElement("div");
        thought.className = "thought";
        thought.innerHTML = `<span class="thought-label label-${label}">${label}</span>${text}`;
        stream.appendChild(thought);
        stream.scrollTop = stream.scrollHeight;

        // Limit to 50 thoughts
        while (stream.children.length > 50) {
          stream.removeChild(stream.firstChild);
        }
      }

      // Send stimulus
      document
        .getElementById("sendBtn")
        .addEventListener("click", sendStimulus);
      document
        .getElementById("stimulusInput")
        .addEventListener("keypress", (e) => {
          if (e.key === "Enter") sendStimulus();
        });

      async function sendStimulus() {
        const input = document.getElementById("stimulusInput");
        const text = input.value.trim();
        if (!text) return;

        addThought("F₁", `USER: ${text}`);
        input.value = "";

        try {
          await fetch("http://localhost:3030/stimulus", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text }),
          });
        } catch (e) {
          addThought("ΔS", "(Demo mode - stimulus not sent to daemon)");
        }
      }

      // Start polling
      setInterval(pollTelemetry, 100); // 10Hz update rate
      pollTelemetry();
    </script>
  </body>
</html>
